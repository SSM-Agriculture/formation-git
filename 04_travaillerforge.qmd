# Travailler avec une forge {.backgroundTitre}

## Git - un modèle distribué

-   **Dépôt local** : dépôt de l'agent sur son espace de travail (sous
    Cerise ou en local par ex.)
-   **Dépôt distant (remote)** : dépôt correspondant situé sur la forge.

::: callout-note
## Convention

Par défaut, le dépôt distant porte l'alias `origin`
:::

![](img/git_distributed.png){fig-align="center"}

## C'est quoi une forge ?

Définition Wikipédia :  

[En informatique, une forge est un système de gestion et de maintenance collaborative de texte.]{.bolder}

[C'est un espace où on peut archiver du code informatique]{.souligneRouge} (R mais pas que bien sûr) qui offre des fonctionnalités supplémentaires à Git comme :

- la **gestion des tickets** (issues) ;  
- les **merge requests ou pull requests** ;
- **un affichage** plus agréable du dépôt **avec une interface web** ;  
- la possibilité d'ajouter **un wiki** ;  
- **l'intégration et le déploiement continus**...

## Exemples de forges

Les plus connues : [Gitlab](https://gitlab.com), [Github](https://github.com), [Bitbucket](https://bitbucket.org)...

Une forge peut être **interne** ou **externe** à un ministère.

- URL de la forge interne du MASA : [https://forge.agriculture.rie.gouv.fr/gitlab/](https://forge.agriculture.rie.gouv.fr/gitlab/)  

- URL de la forge interne du MTECT : [https://gitlab-forge.din.developpement-durable.gouv.fr/](https://gitlab-forge.din.developpement-durable.gouv.fr/)  

- URL du MTECT sur Github : [https://github.com/MTES-MCT](https://github.com/MTES-MCT)

::: callout-note
## À retenir ! 

- Les forges externes ont vocation à héberger les projets open-source. 
Il s'agit donc d'être très vigilant sur le code déposé sur ces forges
:::

## Dialoguer avec Gitlab

Pour travailler avec Gitlab, il faut mettre en place un mode d'authentification.  

2 modes principaux existent : 

- `SSH`  
- `HTTPS`  

Au MASA, [une procédure existe et a été validée](https://orion.agriculture/confluence/pages/viewpage.action?pageId=1068303025) 
pour établir la connexion entre Cerise et la forge gitlab interne. 
Celle-ci est basée sur le mode `HTTPS` et utilise le credential helper de Git qui 
évite d'avoir à re-saisir son mot de passe (ou token) à chaque action.

## Les branches

![](img/schema_vaches_branches_git.png)


## Git revert, git checkout ...

<p style="text-align: center;">[Git permet de consulter n'importe quel état passé du
dépôt]{.content-box-yellow}</p>

Pour revenir en arrière :

-   Sur l'ensemble du dépôt avec l'identifiant d'un commit :
    `git checkout <commitID>`\
-   Sur un seul fichier : `git checkout <commitID> <file-name>`

Pour revenir au présent : `git checkout <branch-name>`

Pour remonter de 4 commits dans le passé : `git checkout <nom-de-branche~3>`


`git revert`


